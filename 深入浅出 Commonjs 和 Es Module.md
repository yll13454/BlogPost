## Commonjs

### 1 commonjs ä½¿ç”¨ä¸åŸç†

åœ¨ä½¿ç”¨  è§„èŒƒä¸‹ï¼Œæœ‰å‡ ä¸ªæ˜¾è‘—çš„ç‰¹ç‚¹ã€‚

- åœ¨ `commonjs` ä¸­æ¯ä¸€ä¸ª js æ–‡ä»¶éƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„æ¨¡å—ï¼Œæˆ‘ä»¬å¯ä»¥ç§°ä¹‹ä¸º moduleï¼›
- è¯¥æ¨¡å—ä¸­ï¼ŒåŒ…å« CommonJS è§„èŒƒçš„æ ¸å¿ƒå˜é‡: exportsã€module.exportsã€requireï¼›
- exports å’Œ module.exports å¯ä»¥è´Ÿè´£å¯¹æ¨¡å—ä¸­çš„å†…å®¹è¿›è¡Œå¯¼å‡ºï¼›
- require å‡½æ•°å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¯¼å…¥å…¶ä»–æ¨¡å—ï¼ˆè‡ªå®šä¹‰æ¨¡å—ã€ç³»ç»Ÿæ¨¡å—ã€ç¬¬ä¸‰æ–¹åº“æ¨¡å—ï¼‰ä¸­çš„å†…å®¹ï¼›

#### commonjs å®ç°åŸç†

é¦–å…ˆä»ä¸Šè¿°å¾—çŸ¥æ¯ä¸ªæ¨¡å—æ–‡ä»¶ä¸Šå­˜åœ¨ `module`ï¼Œ`exports`ï¼Œ`require`ä¸‰ä¸ªå˜é‡ã€‚åœ¨ nodejs ä¸­è¿˜å­˜åœ¨ `__filename` å’Œ `__dirname` å˜é‡ã€‚

- `module` è®°å½•å½“å‰æ¨¡å—ä¿¡æ¯ã€‚
- `require` å¼•å…¥æ¨¡å—çš„æ–¹æ³•ã€‚
- `exports` å½“å‰æ¨¡å—å¯¼å‡ºçš„å±æ€§

åœ¨ç¼–è¯‘çš„è¿‡ç¨‹ä¸­ï¼Œå®é™… Commonjs å¯¹ js çš„ä»£ç å—è¿›è¡Œäº†é¦–å°¾åŒ…è£…

- åœ¨ Commonjs è§„èŒƒä¸‹æ¨¡å—ä¸­ï¼Œä¼šå½¢æˆä¸€ä¸ªåŒ…è£…å‡½æ•°ï¼Œæˆ‘ä»¬å†™çš„ä»£ç å°†ä½œä¸ºåŒ…è£…å‡½æ•°çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œä½¿ç”¨çš„ `require` ï¼Œ`exports` ï¼Œ`module` æœ¬è´¨ä¸Šæ˜¯é€šè¿‡å½¢å‚çš„æ–¹å¼ä¼ é€’åˆ°åŒ…è£…å‡½æ•°ä¸­çš„ã€‚

```js
function wrapper (script) {
    return '(function (exports, require, module, __filename, __dirname) {' + 
        script +
     '\n})'
}
```

åŒ…è£…å‡½æ•°æ‰§è¡Œã€‚

```js
const modulefunction = wrapper(`
  const sayName = require('./hello.js')
    module.exports = function say(){
        return {
            name:sayName(),
            author:'æˆ‘ä¸æ˜¯å¤–æ˜Ÿäºº'
        }
    }
`)
```

- å¦‚ä¸Šæ¨¡æ‹Ÿäº†ä¸€ä¸ªåŒ…è£…å‡½æ•°åŠŸèƒ½ï¼Œ script ä¸ºæˆ‘ä»¬åœ¨ js æ¨¡å—ä¸­å†™çš„å†…å®¹ï¼Œæœ€åè¿”å›çš„å°±æ˜¯å¦‚ä¸ŠåŒ…è£…ä¹‹åçš„å‡½æ•°ã€‚å½“ç„¶è¿™ä¸ªå‡½æ•°æš‚ä¸”æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚

```js
 runInThisContext(modulefunction)(module.exports, require, module, __filename, __dirname)
```

- åœ¨æ¨¡å—åŠ è½½çš„æ—¶å€™ï¼Œä¼šé€šè¿‡ runInThisContext (å¯ä»¥ç†è§£æˆ eval ) æ‰§è¡Œ `modulefunction` ï¼Œä¼ å…¥`require` ï¼Œ`exports` ï¼Œ`module` ç­‰å‚æ•°ã€‚æœ€ç»ˆæˆ‘ä»¬å†™çš„ nodejs æ–‡ä»¶å°±è¿™ä¹ˆæ‰§è¡Œäº†ã€‚

### 2 require æ–‡ä»¶åŠ è½½æµç¨‹

```js
const fs =      require('fs')      // â‘ æ ¸å¿ƒæ¨¡å—
const sayName = require('./hello.js')  //â‘¡ æ–‡ä»¶æ¨¡å—
const crypto =  require('crypto-js')   // â‘¢ç¬¬ä¸‰æ–¹è‡ªå®šä¹‰æ¨¡å—
å¤åˆ¶ä»£ç 
```

å¦‚ä¸Šä»£ç ç‰‡æ®µä¸­ï¼š

- â‘  ä¸º nodejs åº•å±‚çš„æ ¸å¿ƒæ¨¡å—ã€‚
- â‘¡ ä¸ºæˆ‘ä»¬ç¼–å†™çš„æ–‡ä»¶æ¨¡å—ï¼Œæ¯”å¦‚ä¸Šè¿° `sayName`
- â‘¢ ä¸ºæˆ‘ä»¬é€šè¿‡ npm ä¸‹è½½çš„ç¬¬ä¸‰æ–¹è‡ªå®šä¹‰æ¨¡å—ï¼Œæ¯”å¦‚ `crypto-js`ã€‚

#### require åŠ è½½æ ‡è¯†ç¬¦åŸåˆ™

é¦–å…ˆæˆ‘ä»¬çœ‹ä¸€ä¸‹ ` nodejs` ä¸­å¯¹æ ‡è¯†ç¬¦çš„å¤„ç†åŸåˆ™ã€‚

- é¦–å…ˆåƒ fs ï¼Œhttp ï¼Œpath ç­‰æ ‡è¯†ç¬¦ï¼Œä¼šè¢«ä½œä¸º nodejs çš„**æ ¸å¿ƒæ¨¡å—**ã€‚
- ` ./` å’Œ `../` ä½œä¸ºç›¸å¯¹è·¯å¾„çš„**æ–‡ä»¶æ¨¡å—**ï¼Œ `/` ä½œä¸ºç»å¯¹è·¯å¾„çš„**æ–‡ä»¶æ¨¡å—**ã€‚
- éè·¯å¾„å½¢å¼ä¹Ÿéæ ¸å¿ƒæ¨¡å—çš„æ¨¡å—ï¼Œå°†ä½œä¸º**è‡ªå®šä¹‰æ¨¡å—**ã€‚

**æ ¸å¿ƒæ¨¡å—çš„å¤„ç†ï¼š**

æ ¸å¿ƒæ¨¡å—çš„ä¼˜å…ˆçº§ä»…æ¬¡äºç¼“å­˜åŠ è½½ï¼Œåœ¨ `Node` æºç ç¼–è¯‘ä¸­ï¼Œå·²è¢«ç¼–è¯‘æˆäºŒè¿›åˆ¶ä»£ç ï¼Œæ‰€ä»¥åŠ è½½æ ¸å¿ƒæ¨¡å—ï¼ŒåŠ è½½è¿‡ç¨‹ä¸­é€Ÿåº¦æœ€å¿«ã€‚

**è·¯å¾„å½¢å¼çš„æ–‡ä»¶æ¨¡å—å¤„ç†ï¼š**

å·² `./` ï¼Œ`../` å’Œ `/` å¼€å§‹çš„æ ‡è¯†ç¬¦ï¼Œä¼šè¢«å½“ä½œæ–‡ä»¶æ¨¡å—å¤„ç†ã€‚`require()` æ–¹æ³•ä¼šå°†è·¯å¾„è½¬æ¢æˆçœŸå®è·¯å¾„ï¼Œå¹¶ä»¥çœŸå®è·¯å¾„ä½œä¸ºç´¢å¼•ï¼Œå°†ç¼–è¯‘åçš„ç»“æœç¼“å­˜èµ·æ¥ï¼Œç¬¬äºŒæ¬¡åŠ è½½çš„æ—¶å€™ä¼šæ›´å¿«ã€‚

**è‡ªå®šä¹‰æ¨¡å—å¤„ç†ï¼š** è‡ªå®šä¹‰æ¨¡å—ï¼Œä¸€èˆ¬æŒ‡çš„æ˜¯éæ ¸å¿ƒçš„æ¨¡å—ï¼Œå®ƒå¯èƒ½æ˜¯ä¸€ä¸ªæ–‡ä»¶æˆ–è€…ä¸€ä¸ªåŒ…ï¼Œå®ƒçš„æŸ¥æ‰¾ä¼šéµå¾ªä»¥ä¸‹åŸåˆ™ï¼š

- åœ¨å½“å‰ç›®å½•ä¸‹çš„ `node_modules` ç›®å½•æŸ¥æ‰¾ã€‚
- å¦‚æœæ²¡æœ‰ï¼Œåœ¨çˆ¶çº§ç›®å½•çš„ `node_modules` æŸ¥æ‰¾ï¼Œå¦‚æœæ²¡æœ‰åœ¨çˆ¶çº§ç›®å½•çš„çˆ¶çº§ç›®å½•çš„ `node_modules` ä¸­æŸ¥æ‰¾ã€‚
- æ²¿ç€è·¯å¾„å‘ä¸Šé€’å½’ï¼Œç›´åˆ°æ ¹ç›®å½•ä¸‹çš„ `node_modules` ç›®å½•ã€‚
- åœ¨æŸ¥æ‰¾è¿‡ç¨‹ä¸­ï¼Œä¼šæ‰¾ `package.json` ä¸‹ main å±æ€§æŒ‡å‘çš„æ–‡ä»¶ï¼Œå¦‚æœæ²¡æœ‰  `package.json` ï¼Œåœ¨ node ç¯å¢ƒä¸‹ä¼šä»¥æ­¤æŸ¥æ‰¾ `index.js` ï¼Œ`index.json` ï¼Œ`index.node`ã€‚

![4.jpg](media/cfb7a91998774fc78a9813e3b0db8199tplv-k3u1fbpfcp-watermark.awebp)

### 3 require æ¨¡å—å¼•å…¥ä¸å¤„ç†

CommonJS æ¨¡å—åŒæ­¥åŠ è½½å¹¶æ‰§è¡Œæ¨¡å—æ–‡ä»¶ï¼ŒCommonJS æ¨¡å—åœ¨æ‰§è¡Œé˜¶æ®µåˆ†ææ¨¡å—ä¾èµ–ï¼Œé‡‡ç”¨**æ·±åº¦ä¼˜å…ˆéå†**ï¼ˆdepth-first traversalï¼‰ï¼Œæ‰§è¡Œé¡ºåºæ˜¯çˆ¶ -> å­ -> çˆ¶ï¼›

#### require åŠ è½½åŸç†

**`module`** ï¼šåœ¨ Node ä¸­æ¯ä¸€ä¸ª js æ–‡ä»¶éƒ½æ˜¯ä¸€ä¸ª module ï¼Œmodule ä¸Šä¿å­˜äº† exports ç­‰ä¿¡æ¯ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ª **`loaded`** è¡¨ç¤ºè¯¥æ¨¡å—æ˜¯å¦è¢«åŠ è½½ã€‚

- ä¸º `false` è¡¨ç¤ºè¿˜æ²¡æœ‰åŠ è½½ï¼›
- ä¸º `true` è¡¨ç¤ºå·²ç»åŠ è½½

**`Module`** ï¼šä»¥ nodejs ä¸ºä¾‹ï¼Œæ•´ä¸ªç³»ç»Ÿè¿è¡Œä¹‹åï¼Œä¼šç”¨ `Module` ç¼“å­˜æ¯ä¸€ä¸ªæ¨¡å—åŠ è½½çš„ä¿¡æ¯ã€‚

require çš„æºç å¤§è‡´é•¿å¦‚ä¸‹çš„æ ·å­ï¼š

```js
 // id ä¸ºè·¯å¾„æ ‡è¯†ç¬¦
function require(id) {
   /* æŸ¥æ‰¾  Module ä¸Šæœ‰æ²¡æœ‰å·²ç»åŠ è½½çš„ js  å¯¹è±¡*/
   const  cachedModule = Module._cache[id]
   
   /* å¦‚æœå·²ç»åŠ è½½äº†é‚£ä¹ˆç›´æ¥å–èµ°ç¼“å­˜çš„ exports å¯¹è±¡  */
  if(cachedModule){
    return cachedModule.exports
  }
 
  /* åˆ›å»ºå½“å‰æ¨¡å—çš„ module  */
  const module = { exports: {} ,loaded: false , ...}

  /* å°† module ç¼“å­˜åˆ°  Module çš„ç¼“å­˜å±æ€§ä¸­ï¼Œè·¯å¾„æ ‡è¯†ç¬¦ä½œä¸º id */  
  Module._cache[id] = module
  /* åŠ è½½æ–‡ä»¶ */
  runInThisContext(wrapper('module.exports = "123"'))(module.exports, require, module, __filename, __dirname)
  /* åŠ è½½å®Œæˆ *//
  module.loaded = true 
  /* è¿”å›å€¼ */
  return module.exports
}
```

 `require` å¤§è‡´æµç¨‹æ˜¯è¿™æ ·çš„ï¼›

- require ä¼šæ¥æ”¶ä¸€ä¸ªå‚æ•°â€”â€”æ–‡ä»¶æ ‡è¯†ç¬¦ï¼Œç„¶ååˆ†æå®šä½æ–‡ä»¶ï¼Œåˆ†æè¿‡ç¨‹æˆ‘ä»¬ä¸Šè¿°å·²ç»è®²åˆ°äº†ï¼ŒåŠ ä¸‹æ¥ä¼šä» Module ä¸ŠæŸ¥æ‰¾æœ‰æ²¡æœ‰ç¼“å­˜ï¼Œå¦‚æœæœ‰ç¼“å­˜ï¼Œé‚£ä¹ˆç›´æ¥è¿”å›ç¼“å­˜çš„å†…å®¹ã€‚
- å¦‚æœæ²¡æœ‰ç¼“å­˜ï¼Œä¼šåˆ›å»ºä¸€ä¸ª module å¯¹è±¡ï¼Œç¼“å­˜åˆ° Module ä¸Šï¼Œç„¶åæ‰§è¡Œæ–‡ä»¶ï¼ŒåŠ è½½å®Œæ–‡ä»¶ï¼Œå°† loaded å±æ€§è®¾ç½®ä¸º true ï¼Œç„¶åè¿”å› module.exports å¯¹è±¡ã€‚å€Ÿæ­¤å®Œæˆæ¨¡å—åŠ è½½æµç¨‹ã€‚
- æ¨¡å—å¯¼å‡ºå°±æ˜¯ return è¿™ä¸ªå˜é‡çš„å…¶å®è·Ÿ a = b èµ‹å€¼ä¸€æ ·ï¼Œ åŸºæœ¬ç±»å‹å¯¼å‡ºçš„æ˜¯å€¼ï¼Œ å¼•ç”¨ç±»å‹å¯¼å‡ºçš„æ˜¯å¼•ç”¨åœ°å€ã€‚
- exports å’Œ module.exports æŒæœ‰ç›¸åŒå¼•ç”¨ï¼Œå› ä¸ºæœ€åå¯¼å‡ºçš„æ˜¯ module.exportsï¼Œ æ‰€ä»¥å¯¹ exports è¿›è¡Œèµ‹å€¼ä¼šå¯¼è‡´ exports æ“ä½œçš„ä¸å†æ˜¯ module.exports çš„å¼•ç”¨ã€‚

### 4 require åŠ¨æ€åŠ è½½

require å¯ä»¥åœ¨ä»»æ„çš„ä¸Šä¸‹æ–‡ï¼ŒåŠ¨æ€åŠ è½½æ¨¡å—ã€‚

### 5 exports å’Œ module.exports

#### exports ä½¿ç”¨

**ç¬¬ä¸€ç§æ–¹å¼ï¼šexports** `a.js`

```js
exports.name = `ã€ŠReactè¿›é˜¶å®è·µæŒ‡å—ã€‹`
exports.author = `æˆ‘ä¸æ˜¯å¤–æ˜Ÿäºº`
exports.say = function (){
    console.log(666)
}
å¤åˆ¶ä»£ç 
```

**å¼•ç”¨**

```js
const a = require('./a')
console.log(a)
å¤åˆ¶ä»£ç 
```

**æ‰“å°ç»“æœï¼š**

![8.jpg](media/b7522749385e44689893d19b7cc4d999tplv-k3u1fbpfcp-watermark.awebp)

- exports å°±æ˜¯ä¼ å…¥åˆ°å½“å‰æ¨¡å—å†…çš„ä¸€ä¸ªå¯¹è±¡ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ `module.exports`ã€‚

**é—®é¢˜ï¼šä¸ºä»€ä¹ˆ exports={} ç›´æ¥èµ‹å€¼ä¸€ä¸ªå¯¹è±¡å°±ä¸å¯ä»¥å‘¢ï¼Ÿ**

```js
exports={
    name:'ã€ŠReactè¿›é˜¶å®è·µæŒ‡å—ã€‹',
    author:'æˆ‘ä¸æ˜¯å¤–æ˜Ÿäºº',
    say(){
        console.log(666)
    }
}//{}
```

 exports ï¼Œ module å’Œ require ä½œä¸ºå½¢å‚çš„æ–¹å¼ä¼ å…¥åˆ° js æ¨¡å—ä¸­ã€‚æˆ‘ä»¬ç›´æ¥ `exports = {}` ä¿®æ”¹ exports ï¼Œç­‰äºé‡æ–°èµ‹å€¼äº†å½¢å‚ï¼Œé‚£ä¹ˆä¼šé‡æ–°èµ‹å€¼ä¸€ä»½ï¼Œä½†æ˜¯ä¸ä¼šåœ¨å¼•ç”¨åŸæ¥çš„å½¢å‚ã€‚

ä¾‹å­:

```
function wrap (myExports){
    myExports={
       name:'æˆ‘ä¸æ˜¯å¤–æ˜Ÿäºº'
   }
}

let myExports = {
    name:'alien'
}
wrap(myExports)
console.log(myExports)//{ name:'alien'}
```

exports å’Œ module.exports æŒæœ‰ç›¸åŒå¼•ç”¨ï¼Œå› ä¸ºæœ€åå¯¼å‡ºçš„æ˜¯ module.exports ã€‚é‚£ä¹ˆè¿™å°±è¯´æ˜åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬æœ€å¥½é€‰æ‹© `exports` å’Œ `module.exports` ä¸¤è€…ä¹‹ä¸€ï¼Œå¦‚æœä¸¤è€…åŒæ—¶å­˜åœ¨ï¼Œå¾ˆå¯èƒ½ä¼šé€ æˆè¦†ç›–çš„æƒ…å†µå‘ç”Ÿã€‚

**æ—¢ç„¶æœ‰äº† `exports`ï¼Œä¸ºä½•åˆå‡ºäº† `module.exports `?**

ç­”ï¼šå¦‚æœæˆ‘ä»¬ä¸æƒ³åœ¨ commonjs ä¸­å¯¼å‡ºå¯¹è±¡ï¼Œè€Œæ˜¯åªå¯¼å‡ºä¸€ä¸ª**ç±»æˆ–è€…ä¸€ä¸ªå‡½æ•°**å†æˆ–è€…å…¶ä»–å±æ€§çš„æƒ…å†µï¼Œé‚£ä¹ˆ `module.exports` å°±æ›´æ–¹ä¾¿äº†ï¼Œå¦‚ä¸Šæˆ‘ä»¬çŸ¥é“ `exports` ä¼šè¢«åˆå§‹åŒ–æˆä¸€ä¸ªå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åªèƒ½åœ¨å¯¹è±¡ä¸Šç»‘å®šå±æ€§ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ `module.exports` è‡ªå®šä¹‰å¯¼å‡ºå‡ºå¯¹è±¡å¤–çš„å…¶ä»–ç±»å‹å…ƒç´ ã€‚

**ä¸ `exports` ç›¸æ¯”ï¼Œ`module.exports` æœ‰ä»€ä¹ˆç¼ºé™· ï¼Ÿ**

ç­”ï¼š`module.exports` å½“å¯¼å‡ºä¸€äº›å‡½æ•°ç­‰éå¯¹è±¡å±æ€§çš„æ—¶å€™ï¼Œä¹Ÿæœ‰ä¸€äº›é£é™©ï¼Œå°±æ¯”å¦‚å¾ªç¯å¼•ç”¨çš„æƒ…å†µä¸‹ã€‚å¯¹è±¡ä¼šä¿ç•™ç›¸åŒçš„å†…å­˜åœ°å€ï¼Œå°±ç®—ä¸€äº›å±æ€§æ˜¯åç»‘å®šçš„ï¼Œä¹Ÿèƒ½é—´æ¥é€šè¿‡å¼‚æ­¥å½¢å¼è®¿é—®åˆ°ã€‚ä½†æ˜¯å¦‚æœ module.exports ä¸ºä¸€ä¸ªéå¯¹è±¡å…¶ä»–å±æ€§ç±»å‹ï¼Œåœ¨å¾ªç¯å¼•ç”¨çš„æ—¶å€™ï¼Œå°±å®¹æ˜“é€ æˆå±æ€§ä¸¢å¤±çš„æƒ…å†µå‘ç”Ÿäº†ã€‚



## Es Module

Es Module çš„äº§ç”Ÿæœ‰å¾ˆå¤šä¼˜åŠ¿ï¼Œæ¯”å¦‚:

- å€ŸåŠ© `Es Module` çš„é™æ€å¯¼å…¥å¯¼å‡ºçš„ä¼˜åŠ¿ï¼Œå®ç°äº† `tree shaking`ã€‚
- `Es Module` è¿˜å¯ä»¥ `import()` æ‡’åŠ è½½æ–¹å¼å®ç°ä»£ç åˆ†å‰²ã€‚

åœ¨ `Es Module` ä¸­ç”¨ `export` ç”¨æ¥å¯¼å‡ºæ¨¡å—ï¼Œ`import` ç”¨æ¥å¯¼å…¥æ¨¡å—ã€‚

**export æ­£å¸¸å¯¼å‡ºï¼Œimport å¯¼å…¥**

export { }ï¼Œ ä¸å˜é‡åç»‘å®šï¼Œå‘½åå¯¼å‡ºã€‚

import { } from 'module'ï¼Œ å¯¼å…¥ `module` çš„å‘½åå¯¼å‡º ï¼Œmodule ä¸ºå¦‚ä¸Šçš„ `./a.js`

è¿™ç§æƒ…å†µä¸‹ import { } å†…éƒ¨çš„å˜é‡åç§°ï¼Œè¦ä¸ export { } å®Œå…¨åŒ¹é…ã€‚

**é»˜è®¤å¯¼å‡º export default**

- `export default anything` å¯¼å…¥ module çš„é»˜è®¤å¯¼å‡ºã€‚ `anything` å¯ä»¥æ˜¯å‡½æ•°ï¼Œå±æ€§æ–¹æ³•ï¼Œæˆ–è€…å¯¹è±¡ã€‚
- å¯¹äºå¼•å…¥é»˜è®¤å¯¼å‡ºçš„æ¨¡å—ï¼Œ`import anyName from 'module'`ï¼Œ anyName å¯ä»¥æ˜¯è‡ªå®šä¹‰åç§°ã€‚

**æ··åˆå¯¼å…¥ï½œå¯¼å‡º**

å¯¼å‡ºæ¨¡å—ï¼š`a.js`

```js
export const name = 'ã€ŠReactè¿›é˜¶å®è·µæŒ‡å—ã€‹'
export const author = 'æˆ‘ä¸æ˜¯å¤–æ˜Ÿäºº'

export default  function say (){
    console.log('hello , world')
}
```

ç¬¬ä¸€ç§ï¼š

```js
import theSay , { name, author as  bookAuthor } from './a.js'
console.log(
    theSay,     // Æ’ say() {console.log('hello , world') }
    name,       // "ã€ŠReactè¿›é˜¶å®è·µæŒ‡å—ã€‹"
    bookAuthor  // "æˆ‘ä¸æ˜¯å¤–æ˜Ÿäºº"
)
å¤åˆ¶ä»£ç 
```

ç¬¬äºŒç§ï¼š

```js
import theSay, * as mes from './a'
console.log(
    theSay, // Æ’ say() { console.log('hello , world') }
    mes // { name:'ã€ŠReactè¿›é˜¶å®è·µæŒ‡å—ã€‹' , author: "æˆ‘ä¸æ˜¯å¤–æ˜Ÿäºº" ï¼Œdefault:  Æ’ say() { console.log('hello , world') } }
)
```

- å¯¼å‡ºçš„å±æ€§è¢«åˆå¹¶åˆ° `mes` å±æ€§ä¸Šï¼Œ `export` è¢«å¯¼å…¥åˆ°å¯¹åº”çš„å±æ€§ä¸Šï¼Œ`export default` å¯¼å‡ºå†…å®¹è¢«ç»‘å®šåˆ° `default` å±æ€§ä¸Šã€‚ `theSay` ä¹Ÿå¯ä»¥ä½œä¸ºè¢« `export default` å¯¼å‡ºå±æ€§ã€‚

**é‡å®šå‘å¯¼å‡º**

å¯ä»¥æŠŠå½“å‰æ¨¡å—ä½œä¸ºä¸€ä¸ªä¸­è½¬ç«™ï¼Œä¸€æ–¹é¢å¼•å…¥ module å†…çš„å±æ€§ï¼Œç„¶åæŠŠå±æ€§å†ç»™å¯¼å‡ºå»ã€‚

```js
export * from 'module' // ç¬¬ä¸€ç§æ–¹å¼
export { name, author, ..., say } from 'module' // ç¬¬äºŒç§æ–¹å¼
export { bookName as name, bookAuthor as author, ..., say } from 'module' //ç¬¬ä¸‰ç§æ–¹å¼
å¤åˆ¶ä»£ç 
```

- ç¬¬ä¸€ç§æ–¹å¼ï¼šé‡å®šå‘å¯¼å‡º module ä¸­çš„æ‰€æœ‰å¯¼å‡ºå±æ€§ï¼Œ ä½†æ˜¯ä¸åŒ…æ‹¬ `module` å†…çš„ `default` å±æ€§ã€‚
- ç¬¬äºŒç§æ–¹å¼ï¼šä» module ä¸­å¯¼å…¥ name ï¼Œauthor ï¼Œsay å†ä»¥ç›¸åŒçš„å±æ€§åï¼Œå¯¼å‡ºã€‚
- ç¬¬ä¸‰ç§æ–¹å¼ï¼šä» module ä¸­å¯¼å…¥ name ï¼Œé‡å±åä¸º bookName å¯¼å‡ºï¼Œä» module ä¸­å¯¼å…¥ author ï¼Œé‡å±åä¸º bookAuthor å¯¼å‡ºï¼Œæ­£å¸¸å¯¼å‡º say ã€‚

**æ— éœ€å¯¼å…¥æ¨¡å—ï¼Œåªè¿è¡Œæ¨¡å—**

```js
import 'module' 
å¤åˆ¶ä»£ç 
```

- æ‰§è¡Œ module ä¸å¯¼å‡ºå€¼  å¤šæ¬¡è°ƒç”¨ `module` åªè¿è¡Œä¸€æ¬¡ã€‚

**åŠ¨æ€å¯¼å…¥**

```js
const promise = import('module')
å¤åˆ¶ä»£ç 
```

- `import('module') `ï¼ŒåŠ¨æ€å¯¼å…¥è¿”å›ä¸€ä¸ª `Promise`ã€‚ä¸ºäº†æ”¯æŒè¿™ç§æ–¹å¼ï¼Œéœ€è¦åœ¨ webpack ä¸­åšç›¸åº”çš„é…ç½®å¤„ç†ã€‚

### ES6 module ç‰¹æ€§

#### 1 é™æ€è¯­æ³•

ES6 module çš„å¼•å…¥å’Œå¯¼å‡ºæ˜¯é™æ€çš„ï¼Œ`import` ä¼šè‡ªåŠ¨æå‡åˆ°ä»£ç çš„é¡¶å±‚ ï¼Œ`import` , `export` ä¸èƒ½æ”¾åœ¨å—çº§ä½œç”¨åŸŸæˆ–æ¡ä»¶è¯­å¥ä¸­ã€‚

ğŸ™…é”™è¯¯å†™æ³•ä¸€ï¼š

```js
function say(){
  import name from './a.js'  
  export const author = 'æˆ‘ä¸æ˜¯å¤–æ˜Ÿäºº'
}
å¤åˆ¶ä»£ç 
```

ğŸ™…é”™è¯¯å†™æ³•äºŒï¼š

```js
isexport &&  export const  name = 'ã€ŠReactè¿›é˜¶å®è·µæŒ‡å—ã€‹'
å¤åˆ¶ä»£ç 
```

è¿™ç§é™æ€è¯­æ³•ï¼Œåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ç¡®å®šäº†å¯¼å…¥å’Œå¯¼å‡ºçš„å…³ç³»ï¼Œæ‰€ä»¥æ›´æ–¹ä¾¿å»æŸ¥æ‰¾ä¾èµ–ï¼Œæ›´æ–¹ä¾¿å» `tree shaking` (æ‘‡æ ‘) ï¼Œ å¯ä»¥ä½¿ç”¨ lint å·¥å…·å¯¹æ¨¡å—ä¾èµ–è¿›è¡Œæ£€æŸ¥ï¼Œå¯ä»¥å¯¹å¯¼å…¥å¯¼å‡ºåŠ ä¸Šç±»å‹ä¿¡æ¯è¿›è¡Œé™æ€çš„ç±»å‹æ£€æŸ¥ã€‚

import çš„å¯¼å…¥åä¸èƒ½ä¸ºå­—ç¬¦ä¸²æˆ–åœ¨åˆ¤æ–­è¯­å¥ï¼Œä¸‹é¢ä»£ç æ˜¯é”™è¯¯çš„

ğŸ™…é”™è¯¯å†™æ³•ä¸‰ï¼š

```js
import 'defaultExport' from 'module'

let name = 'Export'
import 'default' + name from 'module'
```

#### 2 æ‰§è¡Œç‰¹æ€§

ES6 module å’Œ Common.js ä¸€æ ·ï¼Œå¯¹äºç›¸åŒçš„ js æ–‡ä»¶ï¼Œä¼šä¿å­˜é™æ€å±æ€§ã€‚

ä½†æ˜¯ä¸ Common.js ä¸åŒçš„æ˜¯ ï¼Œ`CommonJS `æ¨¡å—åŒæ­¥åŠ è½½å¹¶æ‰§è¡Œæ¨¡å—æ–‡ä»¶ï¼ŒES6 æ¨¡å—æå‰åŠ è½½å¹¶æ‰§è¡Œæ¨¡å—æ–‡ä»¶ï¼ŒES6 æ¨¡å—åœ¨é¢„å¤„ç†é˜¶æ®µåˆ†ææ¨¡å—ä¾èµ–ï¼Œåœ¨æ‰§è¡Œé˜¶æ®µæ‰§è¡Œæ¨¡å—ï¼Œä¸¤ä¸ªé˜¶æ®µéƒ½é‡‡ç”¨æ·±åº¦ä¼˜å…ˆéå†ï¼Œæ‰§è¡Œé¡ºåºæ˜¯å­ -> çˆ¶ã€‚

#### 3 å¯¼å‡ºç»‘å®š

**ä¸èƒ½ä¿®æ”¹importå¯¼å…¥çš„å±æ€§**

æ¥ä¸‹æ¥å¯¹ import å±æ€§ä½œå‡ºæ€»ç»“ï¼š

- ä½¿ç”¨ import è¢«å¯¼å…¥çš„æ¨¡å—è¿è¡Œåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ã€‚
- ä½¿ç”¨ import è¢«å¯¼å…¥çš„å˜é‡æ˜¯åªè¯»çš„ï¼Œå¯ä»¥ç†è§£é»˜è®¤ä¸º const è£…é¥°ï¼Œæ— æ³•è¢«èµ‹å€¼
- ä½¿ç”¨ import è¢«å¯¼å…¥çš„å˜é‡æ˜¯ä¸åŸå˜é‡ç»‘å®š/å¼•ç”¨çš„ï¼Œå¯ä»¥ç†è§£ä¸º import å¯¼å…¥çš„å˜é‡æ— è®ºæ˜¯å¦ä¸ºåŸºæœ¬ç±»å‹éƒ½æ˜¯å¼•ç”¨ä¼ é€’ã€‚

### import() åŠ¨æ€å¼•å…¥

`import()` è¿”å›ä¸€ä¸ª `Promise` å¯¹è±¡ï¼Œ è¿”å›çš„ `Promise` çš„ then æˆåŠŸå›è°ƒä¸­ï¼Œå¯ä»¥è·å–æ¨¡å—çš„åŠ è½½æˆåŠŸä¿¡æ¯ã€‚

`import()`çš„åŸºæœ¬ç‰¹æ€§ã€‚

- `import()` å¯ä»¥åŠ¨æ€ä½¿ç”¨ï¼ŒåŠ è½½æ¨¡å—ã€‚
- `import()` è¿”å›ä¸€ä¸ª `Promise` ï¼ŒæˆåŠŸå›è°ƒ then ä¸­å¯ä»¥è·å–æ¨¡å—å¯¹åº”çš„ä¿¡æ¯ã€‚ `name` å¯¹åº” name å±æ€§ï¼Œ `default` ä»£è¡¨ `export default` ã€‚`__esModule` ä¸º es module çš„æ ‡è¯†ã€‚

#### import() å¯ä»¥åšä¸€äº›ä»€ä¹ˆ

**åŠ¨æ€åŠ è½½**

- é¦–å…ˆ `import()` åŠ¨æ€åŠ è½½ä¸€äº›å†…å®¹ï¼Œå¯ä»¥æ”¾åœ¨æ¡ä»¶è¯­å¥æˆ–è€…å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­ã€‚

```js
if(isRequire){
    const result  = import('./b')
}
å¤åˆ¶ä»£ç 
```

**æ‡’åŠ è½½**

- `import()` å¯ä»¥å®ç°æ‡’åŠ è½½ï¼Œä¸¾ä¸ªä¾‹å­ vue ä¸­çš„è·¯ç”±æ‡’åŠ è½½ï¼›

```js
[
   {
        path: 'home',
        name: 'é¦–é¡µ',
        component: ()=> import('./home') ,
   },
]
å¤åˆ¶ä»£ç 
```

**Reactä¸­åŠ¨æ€åŠ è½½**

```js
const LazyComponent =  React.lazy(()=>import('./text'))
class index extends React.Component{   
    render(){
        return <React.Suspense fallback={ <div className="icon"><SyncOutlinespin/></div> } >
               <LazyComponent />
           </React.Suspense>
    }
```


ä½œè€…ï¼šæˆ‘ä¸æ˜¯å¤–æ˜Ÿäºº
é“¾æ¥ï¼šhttps://juejin.cn/post/6994224541312483336
æ¥æºï¼šæ˜é‡‘
è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚